@model IEnumerable<Cinema.Models.Movie>
<html>
<head>
    <style>
        #searchInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid;
            border-color: #8B0000;
            border-radius: 4px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h2>Movies List</h2>
    <input type="text" id="searchInput" placeholder="Search by title or genre..." />
    <table class="table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Genre</th>
                @*<th>Actors</th>*@
                <th>Poster</th>
                <th>Plot</th>
                <th>Visitor Rating</th>
                <th>Projection Week</th>
                <th>Price</th>
                @*<th>Tickets</th>*@
                @if (User.IsInRole("Admin"))
                {
                    <th>Actions</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var movie in Model)
            {
                <tr class="search">
                    <td class="name">@movie.Title</td>
                    <td class="genre">@movie.Genre.Name</td>
                    @*     <td>@string.Join(", ",movie.MovieActors
                .Select(a=>a.Actor.FirstName)
                .ToList())</td>*@
                    <td>
                        @if (!string.IsNullOrEmpty(movie.Poster))
                        {
                            <img style="width:280px;height:400px" 
                            src="/uploads/@movie.Poster" />
                        }
                    </td>
                    <td>@movie.Plot</td>
                    <td>@movie.VisitorRating</td>
                    <td>@movie.ProjectionWeek</td>
                    <td>@movie.Price</td>
                    @*      <td>@string.Join(", ",movie.Tickets.Select
                (t=>t.Number).ToList())</td>*@
                    @if (User.IsInRole("Admin"))
                    {
                        <td>
                            <a asp-action="Edit" asp-route-id="@movie.Id"
                               class="btn btn-primary">Edit</a>
                            <form asp-action="Delete" asp-route-id="@movie.Id" method="post"
                                  onsubmit="return confirm('Are you sure you want to delete this movie?');">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
    @if (User.IsInRole("Admin"))
    {
        <a asp-action="Add" asp-controller="Movie" class="btn btn-success">
            Add New Movie
        </a>
    }
    <script>
        function searchMovies() {
            var query = document.getElementById("searchInput").value.toLowerCase();
            var movies = document.getElementsByClassName("search");
            for (var i = 0; i < movies.length; i++) {
                var movie = movies[i];
                var titleElement = movie.getElementsByClassName("name")[0];
                var genreElement = movie.getElementsByClassName("genre")[0];

                var title = titleElement.innerText.toLowerCase();
                var genre = genreElement.innerText.toLowerCase();

                if (title.includes(query) || genre.includes(query)) {
                    movie.style.display = "table-row";
                } else {
                    movie.style.display = "none";
                }
            }
        }

        var searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("keyup", function () {
            searchMovies();
        });
    </script>
</body>
</html>